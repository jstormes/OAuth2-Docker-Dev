version: '3'

############################################################################
# Docker compose for local development
#
# Time Zones:
#    America/Los_Angeles  # PST
#    America/Denver       # MST
#    America/Chicago      # CST
#    America/New_York     # EST


####### OAuth2 Authorization Server ########
services:
  auth-server:
    build: ./authorization-server
    environment:
      - TZ=America/Chicago
      - DB=mysql://auth:naked@db/auth_db
      - REDIS=redis://redis
      - XDEBUG_CONFIG="remote_host=host.docker.internal remote_port=9000 remote_autostart=1"
      - PHP_IDE_CONFIG=serverName=docker-cli
      - PMA_USER=root          # Do Not set this in production !!!!
      - PMA_PASSWORD=AhEP2678  # Do Not set this in production !!!!
    ports:
      - 8080:80
    volumes:
      - ./bin:/root/bin
      - ./authorization-server/:/var/www
      - ./authorization-server/public:/var/www/html


####### Redis #######
  redis:
    image: redis
  redisadmin:
    image: erikdubbelboer/phpredisadmin
    environment:
      - TZ=America/Chicago
      - REDIS_1_HOST=redis
    ports:
      - 8081:80


####### Maria DB ########
  db:
    image: mariadb
    environment:
      - TZ=America/Chicago
      - MYSQL_ROOT_PASSWORD=AhEP2678
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    environment:
      - TZ=America/Chicago
      - PMA_USER=root
      - PMA_PASSWORD=AhEP2678
    ports:
      - 8082:80


####### Open LDAP #######
  ldap:
    image: osixia/openldap
  phpldapadmin:
    image: osixia/phpldapadmin
    environment:
      - PHPLDAPADMIN_LDAP_HOSTS=ldap
    ports:
      - 8083:443
